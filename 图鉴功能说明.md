# 图鉴功能说明

## 功能概述

`/图鉴` 命令现在可以正确显示你钓到的所有鱼类！

## 使用方法

### 1. 查看图鉴总览

```
/图鉴
```

**显示内容：**
- 📊 收集进度（已解锁/总数）
- 📈 各稀有度统计（普通、稀有、史诗、传说）
- 🌑 暗黑鱼统计
- ⭐ 闪光鱼统计
- 🐟 已钓到的鱼列表（最多显示前20种）
  - 按特殊性和稀有度排序
  - 闪光鱼 > 传说鱼 > 史诗鱼 > 稀有鱼 > 普通鱼 > 暗黑鱼
  - 显示每种鱼的最大长度记录

**示例输出：**
```
📚 你的图鉴
进度: 15/200 (7%)

普通: 10/100
稀有: 3/30
史诗: 2/20
传说: 0/20
暗黑鱼: 1/50
闪光鱼: 1/50

🐟 已钓到的鱼:
✨🐢 ✨小龟 (最大7.1cm)
🦈 鲨鱼 (最大89.3cm)
🐠 七彩神仙 (最大16.6cm)
🖤🐉 暗黑龙鱼 (最大78.7cm)
🐟 鲤鱼 (最大32.0cm)
🐟 鲫鱼 (最大12.9cm)
... 还有 9 种

💡 使用 /图鉴 [鱼名] 查看详情
```

### 2. 查看特定鱼类详情

```
/图鉴 鲤鱼
```

**显示内容：**
- 🐟 鱼类名称和emoji
- 📊 稀有度等级
- ✨ 特殊标记（闪光/暗黑）
- 📏 长度范围
- ⏰ 活动时间
- 📖 描述信息
- 📈 你的个人记录
  - 最大长度
  - 捕获次数

**示例输出：**
```
📖 🐟 鲤鱼
稀有度: 普通
长度范围: 20-50cm
活动时间: 6:00-22:00
描述: 常见的淡水鱼，生命力顽强

📊 你的记录:
最大长度: 45.3cm
捕获次数: 5
```

如果还没钓到过：
```
📖 🐟 鲤鱼
稀有度: 普通
长度范围: 20-50cm
活动时间: 6:00-22:00
描述: 常见的淡水鱼，生命力顽强

❓ 你还没有钓到过这种鱼
```

## 排序规则

图鉴列表按以下优先级排序：
1. **闪光鱼** ✨ - 最稀有，排在最前
2. **稀有度** - 传说 > 史诗 > 稀有 > 普通
3. **暗黑鱼** 🖤 - 同稀有度内，暗黑鱼排在后面

## 技术细节

### 数据来源
- 图鉴数据存储在 `unified_data.db` 的 `fish_collection` 表
- 每次钓到新鱼或打破记录时自动更新

### 显示限制
- 图鉴总览最多显示前20种鱼
- 如果超过20种，会显示"... 还有 X 种"
- 可以使用 `/图鉴 [鱼名]` 查看任意鱼的详情

### 统计说明
- **普通鱼**: 不是闪光也不是暗黑的普通稀有度鱼类
- **暗黑鱼**: 带有暗黑属性的鱼（负功德时只能钓到这些）
- **闪光鱼**: 带有闪光属性的鱼（功德≥100时概率提升）
- 一条鱼可以同时是"暗黑"和"稀有"，会被计入两个统计

## 更新内容

### v1.2 (最新)
- ✅ 修复了 `/图鉴` 命令无法触发的问题
- ✅ 修复了 `/头衔` 命令的参数解析
- ✅ 现在可以正确处理带 `/` 前缀的命令

### v1.1
- ✅ 修复了图鉴无法正确显示的问题
- ✅ 添加了已钓到的鱼列表（最多20种）
- ✅ 优化了排序逻辑（闪光鱼优先）
- ✅ 显示每种鱼的最大长度记录
- ✅ 修复了稀有度统计显示

### v1.0 (初始版本)
- 基础图鉴统计功能
- 特定鱼类详情查询

## 常见问题

**Q: 为什么我的图鉴显示0/200？**
A: 你还没有钓过鱼，使用 `/钓鱼` 开始收集吧！

**Q: 为什么看不到某条鱼？**
A: 图鉴总览只显示前20种，使用 `/图鉴 [鱼名]` 查看特定鱼类。

**Q: 暗黑鱼和闪光鱼是什么？**
A: 
- 暗黑鱼：负功德时只能钓到的特殊鱼类
- 闪光鱼：稀有的变种，功德≥100时概率提升至15%

**Q: 如何快速收集图鉴？**
A: 
1. 使用 `/打窝` 提高稀有鱼概率
2. 保持功德≥100提高闪光鱼概率
3. 注意鱼类的活动时间（白天/夜晚）
4. 负功德时专门收集暗黑鱼

## 相关命令

- `/钓鱼` - 钓鱼（消耗1功德）
- `/打窝` - 提高稀有概率（消耗10功德）
- `/钓鱼榜` - 查看钓鱼数量排行
- `/图鉴榜` - 查看图鉴完成度排行
