# QQBot - 基于NoneBot2的QQ机器人

一个基于NoneBot2框架和NapCat的QQ机器人项目，具有AI智能对话、群友人设系统、多种趣味小游戏。

## 功能特性

- 🐱 **AI智能对话**: 温柔猫娘「小喵」人设，支持@机器人进行智能对话
- 🧠 **群友人设系统**: AI会记住每个群友的性格标签，持久化对话历史
- 📏 **今日长度**: 每日随机🐮子长度（8点刷新）
- 🐷 **今日小猪**: 每日专属小猪抽取（8点刷新）
- 🎭 **今日人设**: 随机搞笑身份生成器（8点刷新）
- 🔮 **今日塔罗**: 每日塔罗牌占卜（8点刷新）
- 🪵 **赛博敲木鱼**: 累计功德，支持排行榜
- 🎮 **俄罗斯轮盘**: 中枪禁言5分钟，每小时限玩1次
- 💬 **自动插话**: 智能判断话题，色色/键政必插，普通话题10%概率

## 指令列表

| 指令 | 功能 | 说明 |
|------|------|------|
| `/今日长度` | 🐮子长度 | 每天8点刷新 |
| `/今日小猪` `/抽小猪` | 抽取今日小猪 | 每天8点刷新 |
| `/随机小猪` | 随机抽小猪 | 每次随机 |
| `/今日人设` `/人设` | 搞笑身份 | 每天8点刷新 |
| `/今日塔罗` `/占卜` | 塔罗占卜 | 每天8点刷新 |
| `/敲木鱼` `/木鱼` | 积功德 | 有暴击和负面效果 |
| `/功德榜` | 今日功德排行 | - |
| `/总功德榜` | 历史功德总榜 | - |
| `/开枪` `/轮盘` | 俄罗斯轮盘 | 中枪禁言5分钟 |
| `/轮盘状态` | 查看弹巢状态 | - |
| `/测试` | 测试机器人 | - |
| @机器人 + 内容 | 和小喵聊天 | 持久化对话历史 |

## 安装和部署

### 环境要求

- Python 3.10+
- NapCat (QQ机器人框架)

### 安装依赖

```bash
pip install -r requirements.txt
```

### 配置

1. 复制 `config.example.py` 为 `config.py`
2. 修改配置项：
   - `bot_qq`: 机器人QQ号
   - `onebot_ws_urls`: NapCat WebSocket地址
   - `ai_api_key`: AI API密钥

### 运行

```bash
python bot.py
```

## Docker 部署

```bash
# 构建并启动
docker-compose up -d --build

# 查看日志
docker-compose logs -f

# 重启
docker restart qqbot
```

详见 `DOCKER_DEPLOY.md`

## 插件说明

### AI聊天插件 (`plugins/ai_chat_plugin.py`)
- 温柔猫娘「小喵」人设
- 群友人设系统，记住每个人的性格标签
- 持久化对话历史（SQLite存储）
- 智能自动插话（8-15条触发，色色/键政必插）

### 群友人设系统 (`plugins/profile_db.py`, `plugins/profile_analyzer.py`)
- 每10条消息触发LLM分析
- 自动提取性格标签和重要事件
- 昵称从QQ获取

### 今日系列插件
- `length_plugin.py` - 今日长度
- `pig_plugin.py` - 今日小猪
- `persona_plugin.py` - 今日人设
- `tarot_plugin.py` - 今日塔罗
- 统一8点刷新机制 (`daily_utils.py`)

### 敲木鱼插件 (`plugins/woodfish_plugin.py`)
- 功德累计系统
- 暴击/负面效果
- 今日榜/总榜

### 俄罗斯轮盘 (`plugins/roulette_plugin.py`)
- 6发弹巢，随机1颗子弹
- 中枪禁言5分钟
- 每小时限玩1次（防沉迷）

## 更新日志

### 2026.1.9 v2.0
- 🎮 新增「俄罗斯轮盘」中枪禁言5分钟，每小时限玩1次
- 🪵 新增「赛博敲木鱼」累计功德，支持排行榜
- 🎭 新增「今日人设」随机搞笑身份生成器
- 🔮 新增「今日塔罗」每日占卜，附赠魔法猪图
- 🐱 AI人设升级为温柔猫娘「小喵」
- 🧠 新增群友人设系统，AI会记住你的性格标签
- 💬 优化长期记忆，支持持久化对话历史
- 📉 降低自动插话频率（普通话题仅10%概率）
- ⏰ 统一每日功能8点刷新机制

## 许可证

MIT License
